<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸƒ å©šç¦®åŒæ­¥è·‘æ­¥æ¯”è³½ ğŸ’–</title>
<style>
  body { text-align:center; font-family:"Noto Sans TC", sans-serif; background:linear-gradient(to bottom right,#ffe6f0,#fff); margin:0; padding:20px; }
  h1 { color:#d63384; font-size:2em; margin-bottom:20px; }
  .player { width:90%; margin:10px auto; text-align:left; position:relative; }
  .progress-container { background:#ffe6f2; border-radius:10px; overflow:hidden; height:24px; border:2px solid #f9a8d4; }
  .progress-bar { height:100%; width:0%; background:#f472b6; transition: width 0.2s; }
  .name-label { font-weight:bold; font-size:16px; color:#d63384; margin-bottom:4px; }
  input { padding:6px; border-radius:6px; border:1px solid #ccc; text-align:center; }
  button { margin:5px; padding:10px 20px; font-size:16px; border:none; border-radius:12px; background-color:#ff8fb1; color:white; cursor:pointer; transition:0.2s; }
  button:hover { background-color:#ff6fa2; }
  #winner { font-size:28px; color:green; font-weight:bold; margin-top:20px; }
</style>
</head>
<body>

<h1>ğŸƒ å©šç¦®åŒæ­¥è·‘æ­¥æ¯”è³½ ğŸ’–</h1>

<div id="setupArea">
  <input id="playerName" placeholder="è¼¸å…¥åå­—" style="width:80%; font-size:16px;">
  <br>
  <button id="joinBtn">åŠ å…¥æ¯”è³½</button>
</div>

<div id="raceArea"></div>
<div id="winner"></div>
<div id="myBtnArea"></div>
<button id="resetBtn">é‡æ–°é–‹å§‹</button>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
    apiKey: "AIzaSyAQzK5BX7q7uetIKxKyf80QPkMgCee7O-g",
    authDomain: "index-63c1d.firebaseapp.com",
    databaseURL: "https://index-63c1d-default-rtdb.firebaseio.com",
    projectId: "index-63c1d",
    storageBucket: "index-63c1d.firebasestorage.app",
    messagingSenderId: "259240910482",
    appId: "1:259240910482:web:4e2d9a57fca6367848904b",
    measurementId: "G-YF4Y2S57DV"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const FINISH_LINE = 200;
let playerName = "";
let gameOver = false;

const setupArea = document.getElementById("setupArea");
const raceArea = document.getElementById("raceArea");
const winnerDiv = document.getElementById("winner");
const myBtnArea = document.getElementById("myBtnArea");

document.getElementById("joinBtn").onclick = () => {
    playerName = document.getElementById("playerName").value.trim();
    if(!playerName) return alert("è«‹è¼¸å…¥åå­—ï¼");
    db.ref("players/" + playerName).set({ steps: 0 });
    setupArea.style.display = "none";

    // ç”Ÿæˆè‡ªå·±çš„è·‘æ­¥æŒ‰éˆ•ï¼Œå›ºå®šé¡¯ç¤º
    myBtnArea.innerHTML = "";
    const btn = document.createElement("button");
    btn.innerText = "ğŸƒ é»æˆ‘è·‘ï¼";
    btn.onclick = () => {
        if(gameOver) return;
        db.ref("players/" + playerName + "/steps").transaction(s => (s||0)+1);
    };
    myBtnArea.appendChild(btn);
};

// ç›£è½ç©å®¶è³‡æ–™
db.ref("players").on("value", snapshot => {
    raceArea.innerHTML = "";
    const players = snapshot.val();
    if(!players) return;

    for(let name in players){
        const steps = players[name].steps;
        const percent = Math.min((steps / FINISH_LINE) * 100, 100);

        const div = document.createElement("div");
        div.className = "player";

        const label = document.createElement("div");
        label.className = "name-label";
        label.innerText = name + " ("+steps+")";

        const barContainer = document.createElement("div");
        barContainer.className = "progress-container";

        const bar = document.createElement("div");
        bar.className = "progress-bar";
        bar.style.width = percent + "%";

        barContainer.appendChild(bar);
        div.appendChild(label);
        div.appendChild(barContainer);
        raceArea.appendChild(div);

        if(steps >= FINISH_LINE && !gameOver){
            gameOver = true;
            winnerDiv.innerText = "ğŸ† " + name + " ç²å‹å•¦ï¼ ğŸ‰";
        }
    }
});

// é‡ç½®éŠæˆ²
document.getElementById("resetBtn").onclick = () => {
    db.ref("players").remove();
    raceArea.innerHTML = "";
    winnerDiv.innerText = "";
    myBtnArea.innerHTML = "";
    gameOver=false;
    setupArea.style.display="block";
};
</script>

</body>
</html>
